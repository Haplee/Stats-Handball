============================= test session starts =============================
platform win32 -- Python 3.14.2, pytest-9.0.2, pluggy-1.6.0
rootdir: C:\Users\franc\proyecto\Stats-Handball
plugins: flask-1.3.0
collected 5 items

backend\tests\test_api.py FFF                                            [ 60%]
backend\tests\test_auth.py ..                                            [100%]

================================== FAILURES ===================================
___________________________ test_upload_video_flow ____________________________

client = <FlaskClient <Flask 'app.main'>>

    def test_upload_video_flow(client):
        # Setup user and login
        create_user(client, 'video_user', 'video@test.com', 'pass')
        login(client, 'video_user', 'pass')
    
        # Upload file
        data = {
            'file': (io.BytesIO(b"dummy video content"), 'test_match.mp4')
        }
>       resp = client.post('/api/upload', data=data, content_type='multipart/form-data')
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend\tests\test_api.py:25: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
.venv\Lib\site-packages\werkzeug\test.py:1167: in post
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\testing.py:235: in open
    response = super().open(
.venv\Lib\site-packages\werkzeug\test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\werkzeug\test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\werkzeug\test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask_cors\extension.py:176: in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask_cors\extension.py:176: in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend\app\routes\api.py:26: in decorated_function
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
backend\app\routes\api.py:67: in subir_video_partido
    current_app.celery.send_task(
.venv\Lib\site-packages\celery\app\base.py:841: in send_task
    router = router or amqp.router
                       ^^^^^^^^^^^
.venv\Lib\site-packages\kombu\utils\objects.py:40: in __get__
    return super().__get__(instance, owner)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\AppData\Local\Python\pythoncore-3.14-64\Lib\functools.py:1126: in __get__
    val = self.func(instance)
          ^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\celery\app\amqp.py:623: in router
    return self.Router()
           ^^^^^^^^^^^^^
.venv\Lib\site-packages\celery\app\amqp.py:304: in Router
    return _routes.Router(self.routes, queues or self.queues,
                          ^^^^^^^^^^^
.venv\Lib\site-packages\celery\app\amqp.py:618: in routes
    self.flush_routes()
.venv\Lib\site-packages\celery\app\amqp.py:309: in flush_routes
    self._rtable = _routes.prepare(self.app.conf.task_routes)
                                   ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\celery\utils\collections.py:111: in __getattr__
    return self[k]
           ^^^^^^^
.venv\Lib\site-packages\celery\utils\collections.py:391: in __getitem__
    return getitem(k)
           ^^^^^^^^^^
.venv\Lib\site-packages\celery\utils\collections.py:249: in __getitem__
    return mapping[_key]
           ^^^^^^^^^^^^^
..\..\AppData\Local\Python\pythoncore-3.14-64\Lib\collections\__init__.py:1144: in __getitem__
    if key in self.data:
              ^^^^^^^^^
.venv\Lib\site-packages\kombu\utils\objects.py:40: in __get__
    return super().__get__(instance, owner)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\AppData\Local\Python\pythoncore-3.14-64\Lib\functools.py:1126: in __get__
    val = self.func(instance)
          ^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\celery\app\base.py:227: in data
    return self.callback()
           ^^^^^^^^^^^^^^^
.venv\Lib\site-packages\celery\app\base.py:1130: in _finalize_pending_conf
    conf = self._conf = self._load_config()
                        ^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\celery\app\base.py:1148: in _load_config
    settings = detect_settings(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

conf = {}
preconf = {'APPLICATION_ROOT': '/', 'CELERY_BROKER_URL': 'memory://', 'CELERY_RESULT_BACKEND': 'db+sqlite:///results.db', 'DEBUG': False, ...}
ignore_keys = {'broker_url', 'result_backend'}, prefix = None
all_keys = {'accept_content', 'arangodb_backend_settings', 'azureblockblob_base_path', 'azureblockblob_connection_timeout', 'azureblockblob_container_name', 'azureblockblob_read_timeout', ...}
old_keys = {'AZUREBLOCKBLOB_BASE_PATH', 'AZUREBLOCKBLOB_CONNECTION_TIMEOUT', 'AZUREBLOCKBLOB_CONTAINER_NAME', 'AZUREBLOCKBLOB_READ_TIMEOUT', 'AZUREBLOCKBLOB_RETRY_INCREMENT_BASE', 'AZUREBLOCKBLOB_RETRY_INITIAL_BACKOFF_SEC', ...}

    def detect_settings(conf, preconf=None, ignore_keys=None, prefix=None,
                        all_keys=None, old_keys=None):
        preconf = {} if not preconf else preconf
        ignore_keys = set() if not ignore_keys else ignore_keys
        all_keys = SETTING_KEYS if not all_keys else all_keys
        old_keys = _OLD_SETTING_KEYS if not old_keys else old_keys
    
        source = conf
        if conf is None:
            source, conf = preconf, {}
        have = set(source.keys()) - ignore_keys
        is_in_new = have.intersection(all_keys)
        is_in_old = have.intersection(old_keys)
    
        info = None
        if is_in_new:
            # have new setting names
            info, left = _settings_info, is_in_old
            if is_in_old and len(is_in_old) > len(is_in_new):
                # Majority of the settings are old.
                info, left = _old_settings_info, is_in_new
        if is_in_old:
            # have old setting names, or a majority of the names are old.
            if not info:
                info, left = _old_settings_info, is_in_new
            if is_in_new and len(is_in_new) > len(is_in_old):
                # Majority of the settings are new
                info, left = _settings_info, is_in_old
        else:
            # no settings, just use new format.
            info, left = _settings_info, is_in_old
    
        if prefix:
            # always use new format if prefix is used.
            info, left = _settings_info, set()
    
        # only raise error for keys that the user didn't provide two keys
        # for (e.g., both ``result_expires`` and ``CELERY_TASK_RESULT_EXPIRES``).
        really_left = {key for key in left if info.convert[key] not in have}
        if really_left:
            # user is mixing old/new, or new/old settings, give renaming
            # suggestions.
>           raise ImproperlyConfigured(info.mix_error.format(renames='\n'.join(
                FMT_REPLACE_SETTING.format(replace=key, with_=info.convert[key])
                for key in sorted(really_left)
            )))
E           celery.exceptions.ImproperlyConfigured: 
E           
E           Cannot mix new and old setting keys, please rename the
E           following settings to the new format:
E           
E           CELERY_RESULT_BACKEND                -> result_backend

.venv\Lib\site-packages\celery\app\utils.py:274: ImproperlyConfigured
______________________________ test_delete_video ______________________________

client = <FlaskClient <Flask 'app.main'>>

    def test_delete_video(client):
        # Setup
        create_user(client, 'del_user', 'del@test.com', 'pass')
        login(client, 'del_user', 'pass')
    
        # Upload
        data = {'file': (io.BytesIO(b"content"), 'to_delete.mp4')}
>       resp = client.post('/api/upload', data=data, content_type='multipart/form-data')
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend\tests\test_api.py:48: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
.venv\Lib\site-packages\werkzeug\test.py:1167: in post
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\testing.py:235: in open
    response = super().open(
.venv\Lib\site-packages\werkzeug\test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\werkzeug\test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\werkzeug\test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask_cors\extension.py:176: in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask_cors\extension.py:176: in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend\app\routes\api.py:26: in decorated_function
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
backend\app\routes\api.py:67: in subir_video_partido
    current_app.celery.send_task(
.venv\Lib\site-packages\celery\app\base.py:841: in send_task
    router = router or amqp.router
                       ^^^^^^^^^^^
.venv\Lib\site-packages\kombu\utils\objects.py:40: in __get__
    return super().__get__(instance, owner)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\AppData\Local\Python\pythoncore-3.14-64\Lib\functools.py:1126: in __get__
    val = self.func(instance)
          ^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\celery\app\amqp.py:623: in router
    return self.Router()
           ^^^^^^^^^^^^^
.venv\Lib\site-packages\celery\app\amqp.py:304: in Router
    return _routes.Router(self.routes, queues or self.queues,
                          ^^^^^^^^^^^
.venv\Lib\site-packages\celery\app\amqp.py:618: in routes
    self.flush_routes()
.venv\Lib\site-packages\celery\app\amqp.py:309: in flush_routes
    self._rtable = _routes.prepare(self.app.conf.task_routes)
                                   ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\celery\utils\collections.py:111: in __getattr__
    return self[k]
           ^^^^^^^
.venv\Lib\site-packages\celery\utils\collections.py:391: in __getitem__
    return getitem(k)
           ^^^^^^^^^^
.venv\Lib\site-packages\celery\utils\collections.py:249: in __getitem__
    return mapping[_key]
           ^^^^^^^^^^^^^
..\..\AppData\Local\Python\pythoncore-3.14-64\Lib\collections\__init__.py:1144: in __getitem__
    if key in self.data:
              ^^^^^^^^^
.venv\Lib\site-packages\kombu\utils\objects.py:40: in __get__
    return super().__get__(instance, owner)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\AppData\Local\Python\pythoncore-3.14-64\Lib\functools.py:1126: in __get__
    val = self.func(instance)
          ^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\celery\app\base.py:227: in data
    return self.callback()
           ^^^^^^^^^^^^^^^
.venv\Lib\site-packages\celery\app\base.py:1130: in _finalize_pending_conf
    conf = self._conf = self._load_config()
                        ^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\celery\app\base.py:1148: in _load_config
    settings = detect_settings(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

conf = {}
preconf = {'APPLICATION_ROOT': '/', 'CELERY_BROKER_URL': 'memory://', 'CELERY_RESULT_BACKEND': 'db+sqlite:///results.db', 'DEBUG': False, ...}
ignore_keys = {'broker_url', 'result_backend'}, prefix = None
all_keys = {'accept_content', 'arangodb_backend_settings', 'azureblockblob_base_path', 'azureblockblob_connection_timeout', 'azureblockblob_container_name', 'azureblockblob_read_timeout', ...}
old_keys = {'AZUREBLOCKBLOB_BASE_PATH', 'AZUREBLOCKBLOB_CONNECTION_TIMEOUT', 'AZUREBLOCKBLOB_CONTAINER_NAME', 'AZUREBLOCKBLOB_READ_TIMEOUT', 'AZUREBLOCKBLOB_RETRY_INCREMENT_BASE', 'AZUREBLOCKBLOB_RETRY_INITIAL_BACKOFF_SEC', ...}

    def detect_settings(conf, preconf=None, ignore_keys=None, prefix=None,
                        all_keys=None, old_keys=None):
        preconf = {} if not preconf else preconf
        ignore_keys = set() if not ignore_keys else ignore_keys
        all_keys = SETTING_KEYS if not all_keys else all_keys
        old_keys = _OLD_SETTING_KEYS if not old_keys else old_keys
    
        source = conf
        if conf is None:
            source, conf = preconf, {}
        have = set(source.keys()) - ignore_keys
        is_in_new = have.intersection(all_keys)
        is_in_old = have.intersection(old_keys)
    
        info = None
        if is_in_new:
            # have new setting names
            info, left = _settings_info, is_in_old
            if is_in_old and len(is_in_old) > len(is_in_new):
                # Majority of the settings are old.
                info, left = _old_settings_info, is_in_new
        if is_in_old:
            # have old setting names, or a majority of the names are old.
            if not info:
                info, left = _old_settings_info, is_in_new
            if is_in_new and len(is_in_new) > len(is_in_old):
                # Majority of the settings are new
                info, left = _settings_info, is_in_old
        else:
            # no settings, just use new format.
            info, left = _settings_info, is_in_old
    
        if prefix:
            # always use new format if prefix is used.
            info, left = _settings_info, set()
    
        # only raise error for keys that the user didn't provide two keys
        # for (e.g., both ``result_expires`` and ``CELERY_TASK_RESULT_EXPIRES``).
        really_left = {key for key in left if info.convert[key] not in have}
        if really_left:
            # user is mixing old/new, or new/old settings, give renaming
            # suggestions.
>           raise ImproperlyConfigured(info.mix_error.format(renames='\n'.join(
                FMT_REPLACE_SETTING.format(replace=key, with_=info.convert[key])
                for key in sorted(really_left)
            )))
E           celery.exceptions.ImproperlyConfigured: 
E           
E           Cannot mix new and old setting keys, please rename the
E           following settings to the new format:
E           
E           CELERY_RESULT_BACKEND                -> result_backend

.venv\Lib\site-packages\celery\app\utils.py:274: ImproperlyConfigured
_____________________________ test_privacy_access _____________________________

client = <FlaskClient <Flask 'app.main'>>

    def test_privacy_access(client):
        # User A uploads
        create_user(client, 'user_a', 'a@test.com', 'pass')
        login(client, 'user_a', 'pass')
        data = {'file': (io.BytesIO(b"content"), 'secret.mp4')}
>       resp = client.post('/api/upload', data=data, content_type='multipart/form-data')
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

backend\tests\test_api.py:64: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
.venv\Lib\site-packages\werkzeug\test.py:1167: in post
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\testing.py:235: in open
    response = super().open(
.venv\Lib\site-packages\werkzeug\test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\werkzeug\test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\werkzeug\test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask_cors\extension.py:176: in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask_cors\extension.py:176: in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\flask\app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend\app\routes\api.py:26: in decorated_function
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
backend\app\routes\api.py:67: in subir_video_partido
    current_app.celery.send_task(
.venv\Lib\site-packages\celery\app\base.py:841: in send_task
    router = router or amqp.router
                       ^^^^^^^^^^^
.venv\Lib\site-packages\kombu\utils\objects.py:40: in __get__
    return super().__get__(instance, owner)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\AppData\Local\Python\pythoncore-3.14-64\Lib\functools.py:1126: in __get__
    val = self.func(instance)
          ^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\celery\app\amqp.py:623: in router
    return self.Router()
           ^^^^^^^^^^^^^
.venv\Lib\site-packages\celery\app\amqp.py:304: in Router
    return _routes.Router(self.routes, queues or self.queues,
                          ^^^^^^^^^^^
.venv\Lib\site-packages\celery\app\amqp.py:618: in routes
    self.flush_routes()
.venv\Lib\site-packages\celery\app\amqp.py:309: in flush_routes
    self._rtable = _routes.prepare(self.app.conf.task_routes)
                                   ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\celery\utils\collections.py:111: in __getattr__
    return self[k]
           ^^^^^^^
.venv\Lib\site-packages\celery\utils\collections.py:391: in __getitem__
    return getitem(k)
           ^^^^^^^^^^
.venv\Lib\site-packages\celery\utils\collections.py:249: in __getitem__
    return mapping[_key]
           ^^^^^^^^^^^^^
..\..\AppData\Local\Python\pythoncore-3.14-64\Lib\collections\__init__.py:1144: in __getitem__
    if key in self.data:
              ^^^^^^^^^
.venv\Lib\site-packages\kombu\utils\objects.py:40: in __get__
    return super().__get__(instance, owner)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\AppData\Local\Python\pythoncore-3.14-64\Lib\functools.py:1126: in __get__
    val = self.func(instance)
          ^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\celery\app\base.py:227: in data
    return self.callback()
           ^^^^^^^^^^^^^^^
.venv\Lib\site-packages\celery\app\base.py:1130: in _finalize_pending_conf
    conf = self._conf = self._load_config()
                        ^^^^^^^^^^^^^^^^^^^
.venv\Lib\site-packages\celery\app\base.py:1148: in _load_config
    settings = detect_settings(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

conf = {}
preconf = {'APPLICATION_ROOT': '/', 'CELERY_BROKER_URL': 'memory://', 'CELERY_RESULT_BACKEND': 'db+sqlite:///results.db', 'DEBUG': False, ...}
ignore_keys = {'broker_url', 'result_backend'}, prefix = None
all_keys = {'accept_content', 'arangodb_backend_settings', 'azureblockblob_base_path', 'azureblockblob_connection_timeout', 'azureblockblob_container_name', 'azureblockblob_read_timeout', ...}
old_keys = {'AZUREBLOCKBLOB_BASE_PATH', 'AZUREBLOCKBLOB_CONNECTION_TIMEOUT', 'AZUREBLOCKBLOB_CONTAINER_NAME', 'AZUREBLOCKBLOB_READ_TIMEOUT', 'AZUREBLOCKBLOB_RETRY_INCREMENT_BASE', 'AZUREBLOCKBLOB_RETRY_INITIAL_BACKOFF_SEC', ...}

    def detect_settings(conf, preconf=None, ignore_keys=None, prefix=None,
                        all_keys=None, old_keys=None):
        preconf = {} if not preconf else preconf
        ignore_keys = set() if not ignore_keys else ignore_keys
        all_keys = SETTING_KEYS if not all_keys else all_keys
        old_keys = _OLD_SETTING_KEYS if not old_keys else old_keys
    
        source = conf
        if conf is None:
            source, conf = preconf, {}
        have = set(source.keys()) - ignore_keys
        is_in_new = have.intersection(all_keys)
        is_in_old = have.intersection(old_keys)
    
        info = None
        if is_in_new:
            # have new setting names
            info, left = _settings_info, is_in_old
            if is_in_old and len(is_in_old) > len(is_in_new):
                # Majority of the settings are old.
                info, left = _old_settings_info, is_in_new
        if is_in_old:
            # have old setting names, or a majority of the names are old.
            if not info:
                info, left = _old_settings_info, is_in_new
            if is_in_new and len(is_in_new) > len(is_in_old):
                # Majority of the settings are new
                info, left = _settings_info, is_in_old
        else:
            # no settings, just use new format.
            info, left = _settings_info, is_in_old
    
        if prefix:
            # always use new format if prefix is used.
            info, left = _settings_info, set()
    
        # only raise error for keys that the user didn't provide two keys
        # for (e.g., both ``result_expires`` and ``CELERY_TASK_RESULT_EXPIRES``).
        really_left = {key for key in left if info.convert[key] not in have}
        if really_left:
            # user is mixing old/new, or new/old settings, give renaming
            # suggestions.
>           raise ImproperlyConfigured(info.mix_error.format(renames='\n'.join(
                FMT_REPLACE_SETTING.format(replace=key, with_=info.convert[key])
                for key in sorted(really_left)
            )))
E           celery.exceptions.ImproperlyConfigured: 
E           
E           Cannot mix new and old setting keys, please rename the
E           following settings to the new format:
E           
E           CELERY_RESULT_BACKEND                -> result_backend

.venv\Lib\site-packages\celery\app\utils.py:274: ImproperlyConfigured
============================== warnings summary ===============================
backend/tests/test_api.py: 9 warnings
backend/tests/test_auth.py: 2 warnings
  C:\Users\franc\proyecto\Stats-Handball\.venv\Lib\site-packages\sqlalchemy\sql\schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

backend/tests/test_api.py::test_upload_video_flow
backend/tests/test_api.py::test_delete_video
backend/tests/test_api.py::test_privacy_access
backend/tests/test_auth.py::test_register_login_logout
  C:\Users\franc\proyecto\Stats-Handball\backend\app\routes\auth.py:60: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    user.last_login = datetime.datetime.utcnow()

backend/tests/test_auth.py::test_register_login_logout
  C:\Users\franc\proyecto\Stats-Handball\backend\app\routes\auth.py:98: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    user = User.query.get(session['user_id'])

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED backend/tests/test_api.py::test_upload_video_flow - celery.exceptions....
FAILED backend/tests/test_api.py::test_delete_video - celery.exceptions.Impro...
FAILED backend/tests/test_api.py::test_privacy_access - celery.exceptions.Imp...
================== 3 failed, 2 passed, 16 warnings in 2.21s ===================
